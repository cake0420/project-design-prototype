<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>새 게시글 작성 - 재능 기부 플랫폼</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: { primary: "#4F46E5", secondary: "#10B981" },
            borderRadius: {
              none: "0px",
              sm: "4px",
              DEFAULT: "8px",
              md: "12px",
              lg: "16px",
              xl: "20px",
              "2xl": "24px",
              "3xl": "32px",
              full: "9999px",
              button: "8px",
            },
          },
        },
      };
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <style>
      :where([class^="ri-"])::before { content: "\f3c2"; }
      body {
          font-family: 'Noto Sans KR', sans-serif;
          background-color: #f9fafb;
      }
      .custom-scrollbar::-webkit-scrollbar {
          width: 6px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
          background: #f1f1f1;
          border-radius: 10px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
          background: #d1d5db;
          border-radius: 10px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: #9ca3af;
      }
      .editor-toolbar button {
          width: 2rem;
          height: 2rem;
          display: flex;
          align-items: center;
          justify-content: center;
          border-radius: 4px;
          color: #4b5563;
          transition: all 0.2s;
      }
      .editor-toolbar button:hover {
          background-color: #f3f4f6;
      }
      .editor-toolbar button.active {
          background-color: #e5e7eb;
          color: #4F46E5;
      }
      .tag-input:focus {
          outline: none;
          box-shadow: none;
      }
      input[type="number"]::-webkit-inner-spin-button,
      input[type="number"]::-webkit-outer-spin-button {
          -webkit-appearance: none;
          margin: 0;
      }
    </style>
  </head>
  <body>
    <header class="bg-white shadow-sm">
      <div
        class="container mx-auto px-4 py-4 flex items-center justify-between"
      >
        <div class="flex items-center">
          <h1 class="text-2xl font-['Pacifico'] text-primary">재능나눔</h1>
          <nav class="ml-10 hidden md:block">
            <ul class="flex space-x-8">
              <li>
                <a href="#" class="text-gray-800 hover:text-primary font-medium"
                  >홈</a
                >
              </li>
              <li>
                <a href="#" class="text-gray-800 hover:text-primary font-medium"
                  >매칭</a
                >
              </li>
              <li>
                <a
                  href="https://readdy.ai/home/ac21da48-6871-4806-adae-3402107fffdd/b7baf916-1754-43c5-8692-ad365db6ac9f"
                  data-readdy="true"
                  class="text-primary font-medium border-b-2 border-primary"
                  >커뮤니티</a
                >
              </li>
              <li>
                <a href="#" class="text-gray-800 hover:text-primary font-medium"
                  >마이페이지</a
                >
              </li>
            </ul>
          </nav>
        </div>
        <div class="flex items-center space-x-4">
          <button
            class="bg-white text-gray-700 border border-gray-300 px-4 py-2 rounded-button whitespace-nowrap hover:bg-gray-50"
          >
            로그인
          </button>
          <button
            class="bg-primary text-white px-4 py-2 rounded-button whitespace-nowrap hover:bg-indigo-600"
          >
            회원가입
          </button>
          <div class="w-10 h-10 flex items-center justify-center md:hidden">
            <i class="ri-menu-line text-gray-700 ri-lg"></i>
          </div>
        </div>
      </div>
    </header>

    <main class="container mx-auto px-4 py-6">
      <div class="bg-white rounded-lg shadow-sm p-6 max-w-4xl mx-auto">
        <!-- 헤더 영역 -->
        <div
          class="flex items-center justify-between mb-6 pb-4 border-b border-gray-200"
        >
          <h1 class="text-2xl font-bold text-gray-800">새 게시글 작성</h1>
          <a
            href="https://readdy.ai/home/ac21da48-6871-4806-adae-3402107fffdd/b7baf916-1754-43c5-8692-ad365db6ac9f"
            data-readdy="true"
            class="flex items-center text-gray-600 hover:text-primary"
          >
            <div class="w-5 h-5 flex items-center justify-center mr-1">
              <i class="ri-arrow-left-line"></i>
            </div>
            <span>뒤로가기</span>
          </a>
        </div>

        <!-- 폼 영역 -->
        <form id="postForm">
          <!-- 제목 입력 -->
          <div class="mb-6">
            <label
              for="title"
              class="block text-sm font-medium text-gray-700 mb-1"
              >제목 <span class="text-red-500">*</span></label
            >
            <div class="relative">
              <input
                type="text"
                id="title"
                name="title"
                placeholder="제목을 입력하세요"
                maxlength="100"
                class="w-full px-4 py-3 border border-gray-300 rounded text-gray-800 focus:ring-2 focus:ring-primary focus:border-transparent text-sm"
                required
              />
              <div class="absolute right-3 bottom-3 text-xs text-gray-500">
                <span id="titleCount">0</span>/100
              </div>
            </div>
          </div>

          <!-- 카테고리 선택 -->
          <div class="mb-6">
            <label
              for="category"
              class="block text-sm font-medium text-gray-700 mb-1"
              >카테고리 <span class="text-red-500">*</span></label
            >
            <div class="relative">
              <button
                type="button"
                id="categoryButton"
                class="w-full px-4 py-3 border border-gray-300 rounded text-left text-gray-500 focus:ring-2 focus:ring-primary focus:border-transparent text-sm bg-white pr-10"
              >
                카테고리 선택
              </button>
              <div
                class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"
              >
                <div class="w-5 h-5 flex items-center justify-center">
                  <i class="ri-arrow-down-s-line text-gray-400"></i>
                </div>
              </div>
              <div
                id="categoryDropdown"
                class="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg hidden"
              >
                <ul class="py-1 max-h-60 overflow-auto custom-scrollbar">
                  <li
                    class="px-4 py-2 hover:bg-gray-100 cursor-pointer text-sm"
                    data-value="question"
                  >
                    질문/답변
                  </li>
                  <li
                    class="px-4 py-2 hover:bg-gray-100 cursor-pointer text-sm"
                    data-value="info"
                  >
                    정보공유
                  </li>
                  <li
                    class="px-4 py-2 hover:bg-gray-100 cursor-pointer text-sm"
                    data-value="review"
                  >
                    후기
                  </li>
                  <li
                    class="px-4 py-2 hover:bg-gray-100 cursor-pointer text-sm"
                    data-value="free"
                  >
                    자유게시판
                  </li>
                </ul>
              </div>
              <input
                type="hidden"
                id="categoryValue"
                name="category"
                required
              />
            </div>
          </div>

          <!-- 태그 입력 -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >태그 (최대 5개)</label
            >
            <div
              class="flex flex-wrap gap-2 p-2 border border-gray-300 rounded bg-white min-h-12 mb-1"
            >
              <div id="tagContainer" class="flex flex-wrap gap-2"></div>
              <input
                type="text"
                id="tagInput"
                class="tag-input flex-1 min-w-20 text-sm py-1 border-none"
                placeholder="태그를 입력하고 Enter를 누르세요"
              />
            </div>
            <p class="text-xs text-gray-500">
              태그는 쉼표(,) 또는 Enter로 구분됩니다.
            </p>
          </div>

          <!-- 본문 에디터 -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >본문 <span class="text-red-500">*</span></label
            >
            <div class="border border-gray-300 rounded overflow-hidden">
              <!-- 에디터 툴바 -->
              <div
                class="editor-toolbar flex flex-wrap gap-1 p-2 bg-gray-50 border-b border-gray-300"
              >
                <button
                  type="button"
                  data-command="bold"
                  class="tooltip"
                  title="굵게"
                >
                  <div class="w-4 h-4 flex items-center justify-center">
                    <i class="ri-bold"></i>
                  </div>
                </button>
                <button
                  type="button"
                  data-command="italic"
                  class="tooltip"
                  title="기울임"
                >
                  <div class="w-4 h-4 flex items-center justify-center">
                    <i class="ri-italic"></i>
                  </div>
                </button>
                <button
                  type="button"
                  data-command="underline"
                  class="tooltip"
                  title="밑줄"
                >
                  <div class="w-4 h-4 flex items-center justify-center">
                    <i class="ri-underline"></i>
                  </div>
                </button>
                <div class="w-px h-6 bg-gray-300 mx-1"></div>
                <button
                  type="button"
                  data-command="justifyLeft"
                  class="tooltip"
                  title="왼쪽 정렬"
                >
                  <div class="w-4 h-4 flex items-center justify-center">
                    <i class="ri-align-left"></i>
                  </div>
                </button>
                <button
                  type="button"
                  data-command="justifyCenter"
                  class="tooltip"
                  title="가운데 정렬"
                >
                  <div class="w-4 h-4 flex items-center justify-center">
                    <i class="ri-align-center"></i>
                  </div>
                </button>
                <button
                  type="button"
                  data-command="justifyRight"
                  class="tooltip"
                  title="오른쪽 정렬"
                >
                  <div class="w-4 h-4 flex items-center justify-center">
                    <i class="ri-align-right"></i>
                  </div>
                </button>
                <div class="w-px h-6 bg-gray-300 mx-1"></div>
                <button
                  type="button"
                  data-command="insertUnorderedList"
                  class="tooltip"
                  title="글머리 기호"
                >
                  <div class="w-4 h-4 flex items-center justify-center">
                    <i class="ri-list-unordered"></i>
                  </div>
                </button>
                <button
                  type="button"
                  data-command="insertOrderedList"
                  class="tooltip"
                  title="번호 매기기"
                >
                  <div class="w-4 h-4 flex items-center justify-center">
                    <i class="ri-list-ordered"></i>
                  </div>
                </button>
                <div class="w-px h-6 bg-gray-300 mx-1"></div>
                <button
                  type="button"
                  id="insertLink"
                  class="tooltip"
                  title="링크 삽입"
                >
                  <div class="w-4 h-4 flex items-center justify-center">
                    <i class="ri-link"></i>
                  </div>
                </button>
                <button
                  type="button"
                  id="insertImage"
                  class="tooltip"
                  title="이미지 삽입"
                >
                  <div class="w-4 h-4 flex items-center justify-center">
                    <i class="ri-image-line"></i>
                  </div>
                </button>
              </div>

              <!-- 에디터 본문 -->
              <div
                id="editor"
                class="p-4 min-h-64 max-h-96 overflow-y-auto custom-scrollbar"
                contenteditable="true"
              ></div>
            </div>
          </div>

          <!-- 이미지 업로드 영역 -->
          <div class="mb-8">
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >이미지 첨부 (최대 5개)</label
            >
            <div
              id="dropArea"
              class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:bg-gray-50 transition cursor-pointer"
            >
              <div
                class="w-12 h-12 mx-auto mb-2 flex items-center justify-center text-gray-400"
              >
                <i class="ri-upload-cloud-line ri-2x"></i>
              </div>
              <p class="text-gray-600 mb-1">이미지를 여기에 끌어다 놓거나</p>
              <button
                type="button"
                id="browseButton"
                class="text-primary hover:underline"
              >
                파일 찾기
              </button>
              <input
                type="file"
                id="fileInput"
                accept="image/*"
                multiple
                class="hidden"
              />
              <p class="text-xs text-gray-500 mt-2">
                지원 형식: JPG, PNG, GIF (파일당 최대 5MB)
              </p>
            </div>

            <!-- 이미지 미리보기 영역 -->
            <div
              id="previewContainer"
              class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3 mt-4"
            ></div>
          </div>

          <!-- 버튼 영역 -->
          <div class="flex justify-between pt-4 border-t border-gray-200">
            <a
              href="https://readdy.ai/home/ac21da48-6871-4806-adae-3402107fffdd/b7baf916-1754-43c5-8692-ad365db6ac9f"
              data-readdy="true"
              class="px-6 py-2.5 border border-gray-300 rounded-button text-gray-700 hover:bg-gray-50 whitespace-nowrap"
              >취소</a
            >
            <button
              type="submit"
              class="px-6 py-2.5 bg-primary text-white rounded-button hover:bg-indigo-600 whitespace-nowrap"
            >
              등록
            </button>
          </div>
        </form>
      </div>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // 제목 글자수 카운터
        const titleInput = document.getElementById("title");
        const titleCount = document.getElementById("titleCount");

        titleInput.addEventListener("input", function () {
          titleCount.textContent = this.value.length;
        });

        // 카테고리 드롭다운
        const categoryButton = document.getElementById("categoryButton");
        const categoryDropdown = document.getElementById("categoryDropdown");
        const categoryItems = categoryDropdown.querySelectorAll("li");
        const categoryValue = document.getElementById("categoryValue");

        categoryButton.addEventListener("click", function () {
          categoryDropdown.classList.toggle("hidden");
        });

        categoryItems.forEach((item) => {
          item.addEventListener("click", function () {
            const value = this.getAttribute("data-value");
            const text = this.textContent;

            categoryButton.textContent = text;
            categoryValue.value = value;
            categoryDropdown.classList.add("hidden");
            categoryButton.classList.remove("text-gray-500");
            categoryButton.classList.add("text-gray-800");
          });
        });

        document.addEventListener("click", function (event) {
          if (
            !categoryButton.contains(event.target) &&
            !categoryDropdown.contains(event.target)
          ) {
            categoryDropdown.classList.add("hidden");
          }
        });

        // 태그 입력 처리
        const tagInput = document.getElementById("tagInput");
        const tagContainer = document.getElementById("tagContainer");
        const tags = new Set();

        function addTag(tagText) {
          if (tagText.trim() === "" || tags.size >= 5) return;

          if (!tags.has(tagText)) {
            tags.add(tagText);

            const tagElement = document.createElement("div");
            tagElement.className =
              "flex items-center bg-gray-100 rounded-full px-3 py-1 text-sm";
            tagElement.innerHTML = `
                      <span>${tagText}</span>
                      <button type="button" class="ml-1 text-gray-500 hover:text-gray-700" data-tag="${tagText}">
                          <div class="w-4 h-4 flex items-center justify-center">
                              <i class="ri-close-line"></i>
                          </div>
                      </button>
                  `;

            tagContainer.appendChild(tagElement);

            // 태그 삭제 이벤트
            const deleteButton = tagElement.querySelector("button");
            deleteButton.addEventListener("click", function () {
              const tagToRemove = this.getAttribute("data-tag");
              tags.delete(tagToRemove);
              tagElement.remove();
            });
          }

          tagInput.value = "";
        }

        tagInput.addEventListener("keydown", function (e) {
          if (e.key === "Enter" || e.key === ",") {
            e.preventDefault();
            addTag(this.value.trim());
          }
        });

        tagInput.addEventListener("blur", function () {
          if (this.value.trim()) {
            addTag(this.value.trim());
          }
        });

        // 리치 텍스트 에디터
        const editor = document.getElementById("editor");
        const editorButtons = document.querySelectorAll(
          ".editor-toolbar button[data-command]",
        );

        editorButtons.forEach((button) => {
          button.addEventListener("click", function () {
            const command = this.getAttribute("data-command");
            document.execCommand(command, false, null);
            editor.focus();
          });
        });

        // 링크 삽입
        document.getElementById("insertLink").addEventListener("click", function () {
          const url = prompt("링크 URL을 입력하세요:", "https://");
          if (url) {
            document.execCommand("createLink", false, url);
          }
        });

        // 이미지 업로드 처리
        const dropArea = document.getElementById("dropArea");
        const fileInput = document.getElementById("fileInput");
        const browseButton = document.getElementById("browseButton");
        const previewContainer = document.getElementById("previewContainer");
        let uploadedFiles = [];

        browseButton.addEventListener("click", function () {
          fileInput.click();
        });

        dropArea.addEventListener("dragover", function (e) {
          e.preventDefault();
          dropArea.classList.add("border-primary");
        });

        dropArea.addEventListener("dragleave", function () {
          dropArea.classList.remove("border-primary");
        });

        dropArea.addEventListener("drop", function (e) {
          e.preventDefault();
          dropArea.classList.remove("border-primary");

          if (e.dataTransfer.files.length > 0) {
            handleFiles(e.dataTransfer.files);
          }
        });

        fileInput.addEventListener("change", function () {
          handleFiles(this.files);
        });

        function handleFiles(files) {
          if (uploadedFiles.length + files.length > 5) {
            alert("이미지는 최대 5개까지 업로드할 수 있습니다.");
            return;
          }

          Array.from(files).forEach((file) => {
            if (!file.type.match("image.*")) {
              alert("이미지 파일만 업로드할 수 있습니다.");
              return;
            }

            if (file.size > 5 * 1024 * 1024) {
              alert("파일 크기는 5MB를 초과할 수 없습니다.");
              return;
            }

            uploadedFiles.push(file);

            const reader = new FileReader();
            reader.onload = function (e) {
              const preview = document.createElement("div");
              preview.className = "relative group";
              preview.innerHTML = `
                          <div class="aspect-w-1 aspect-h-1 w-full overflow-hidden rounded">
                              <img src="${e.target.result}" alt="미리보기" class="w-full h-full object-cover">
                          </div>
                          <button type="button" class="absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition">
                              <div class="w-4 h-4 flex items-center justify-center">
                                  <i class="ri-delete-bin-line"></i>
                              </div>
                          </button>
                      `;

              previewContainer.appendChild(preview);

              // 이미지 삭제 이벤트
              const deleteButton = preview.querySelector("button");
              deleteButton.addEventListener("click", function () {
                const index = Array.from(previewContainer.children).indexOf(preview);
                uploadedFiles.splice(index, 1);
                preview.remove();
              });

              // 에디터에 이미지 삽입 이벤트
              preview.querySelector("img").addEventListener("click", function () {
                document.execCommand("insertImage", false, e.target.result);
                editor.focus();
              });
            };

            reader.readAsDataURL(file);
          });
        }

        // 이미지 삽입 버튼
        document.getElementById("insertImage").addEventListener("click", function () {
          fileInput.click();
        });

        // 폼 제출
        document.getElementById("postForm").addEventListener("submit", function (e) {
          e.preventDefault();

          // 필수 항목 검증
          const title = document.getElementById("title").value;
          const category = document.getElementById("categoryValue").value;
          const content = document.getElementById("editor").innerHTML;

          if (!title) {
            alert("제목을 입력해주세요.");
            document.getElementById("title").focus();
            return;
          }

          if (!category) {
            alert("카테고리를 선택해주세요.");
            document.getElementById("categoryButton").focus();
            return;
          }

          if (!content || content === "<br>") {
            alert("본문을 입력해주세요.");
            document.getElementById("editor").focus();
            return;
          }

          // 폼 데이터 수집
          const formData = new FormData();
          formData.append("title", title);
          formData.append("category", category);
          formData.append("content", content);

          // 태그 추가
          const tagsArray = Array.from(tags);
          tagsArray.forEach((tag) => {
            formData.append("tags[]", tag);
          });

          // 이미지 파일 추가
          uploadedFiles.forEach((file) => {
            formData.append("images[]", file);
          });

          // 서버로 데이터 전송 (실제 구현에서는 fetch 또는 axios 사용)
          console.log("폼 제출됨", {
            title,
            category,
            content,
            tags: tagsArray,
            uploadedFiles,
          });

          // 성공 시 커뮤니티 페이지로 이동
          alert("게시글이 등록되었습니다.");
          window.location.href =
            "https://readdy.ai/home/ac21da48-6871-4806-adae-3402107fffdd/b7baf916-1754-43c5-8692-ad365db6ac9f";
        });

        // 페이지 이탈 경고
        window.addEventListener("beforeunload", function (e) {
          if (
            titleInput.value ||
            (editor.innerHTML !== "" && editor.innerHTML !== "<br>") ||
            uploadedFiles.length > 0
          ) {
            e.preventDefault();
            e.returnValue = "";
            return "";
          }
        });
      });
    </script>
  </body>
</html>
